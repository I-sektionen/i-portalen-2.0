<mat-card class="container">
  <div fxLayout="column" fxLayoutAlign="start middle">
    <mat-card-header>
      Artikeluppgifter
    </mat-card-header>

    <mat-card-content>
      <form>
        <div fxLayout="row">
          <mat-form-field>
            <input
              matInput
              placeholder="Rubrik"
              [(ngModel)]="post.title"
              name="title"
            />
          </mat-form-field>
        </div>
        <div>
          <mat-form-field>
            <mat-label>Ingress</mat-label>
            <textarea
              matInput
              cdkTextareaAutosize
              #autosize="cdkTextareaAutosize"
              cdkAutosizeMinRows="1"
              cdkAutosizeMaxRows="5"
              [(ngModel)]="post.ingress"
              name="ingress"
              maxlength="160"
            ></textarea>
            <mat-hint align="end"> {{ post.ingress.length }} / 160</mat-hint>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field>
            <mat-label>Kategori</mat-label>
            <mat-select
              [(ngModel)]="post.choosenCategories"
              name="choosenCategories"
              matInput
              multiple
            >
              <mat-select-trigger>
                <mat-chip-list>
                  <mat-chip
                    *ngFor="let category of post.choosenCategories"
                    color="primary"
                    selected
                  >
                    {{ category.name }}
                  </mat-chip>
                </mat-chip-list>
              </mat-select-trigger>
              <mat-option
                *ngFor="let category of post.availableCategories"
                [value]="category"
              >
                {{ category.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Publish date & time. -->
        <div fxFlex="35%" fxLayout="row" fxLayout.md="row">
          <div fxFlex="40%">
            <mat-form-field>
              <label class="example-input-wrapper">
                <input
                  matInput
                  placeholder="Publiceringsdatum"
                  [(ngModel)]="post.publishDate"
                  name="publishDate"
                  [min]="minPublishDate"
                  [owlDateTimeTrigger]="pd"
                  [owlDateTime]="pd"
                />
                <owl-date-time #pd></owl-date-time>
              </label>
            </mat-form-field>
          </div>

          <!-- Unpublish date & time -->
          <div fxFlex="40%">
            <mat-form-field>
              <label class="example-input-wrapper">
                <input
                  matInput
                  placeholder="Avpubliceringsdatum"
                  [(ngModel)]="post.unpublishDate"
                  name="unpublishDate"
                  [min]="post.publishDate"
                  [owlDateTimeTrigger]="upd"
                  [owlDateTime]="upd"
                />
                <owl-date-time #upd></owl-date-time>
              </label>
            </mat-form-field>
          </div>
        </div>

        <!-- Slider for isEvent -->
        <div
          style="display: flex; flex-direction: row; align-items: center"
          class="row"
        >
          {{ typeOne }}
          <mat-slide-toggle [(ngModel)]="post.isEvent" name="isEvent">
          </mat-slide-toggle>
          {{ typeTwo }}
        </div>

        <!-- Attributes only belonging to events -->
        <ng-container *ngIf="post.isEvent">
          <!-- Event starting time -->
          <mat-label> Start- & sluttid för event </mat-label>
          <div style="display: flex; flex-direction: row">
            <mat-form-field>
              <label class="example-input-wrapper">
                <input
                  matInput
                  placeholder="Starttid"
                  [(ngModel)]="post.eventStartTime"
                  name="eventStartTime"
                  [min]="post.publishTime"
                  [owlDateTimeTrigger]="est"
                  [owlDateTime]="est"
                />
                <owl-date-time #est></owl-date-time>
              </label>
            </mat-form-field>
          </div>

          <!-- Event finishing time -->
          <div style="display: flex; flex-direction: row">
            <mat-form-field>
              <label class="example-input-wrapper">
                <input
                  matInput
                  placeholder="Sluttid"
                  [(ngModel)]="post.eventFinishTime"
                  name="eventFinishTime"
                  [min]="post.publishTime"
                  [owlDateTimeTrigger]="eft"
                  [owlDateTime]="eft"
                />
                <owl-date-time #eft></owl-date-time>
              </label>
            </mat-form-field>
          </div>

          <!-- Last date for registering -->
          <div style="display: flex; flex-direction: row">
            <mat-form-field>
              <label class="example-input-wrapper">
                <input
                  matInput
                  placeholder="Sista dag för registering"
                  [(ngModel)]="post.lastRegisterDate"
                  name="lastRegisterDate"
                  [min]="post.publishTime"
                  [owlDateTimeTrigger]="lrd"
                  [owlDateTime]="lrd"
                />
                <owl-date-time
                  [startAt]="post.eventStartTime"
                  #lrd
                ></owl-date-time>
              </label>
            </mat-form-field>
          </div>

          <!-- Last date for unregistering -->
          <div style="display: flex; flex-direction: row">
            <mat-form-field>
              <label class="example-input-wrapper">
                <input
                  matInput
                  placeholder="Sista dag för avregistering"
                  [(ngModel)]="post.lastUnregisterDate"
                  name="lastUnregisterDate"
                  [min]="post.publishTime"
                  [owlDateTimeTrigger]="lud"
                  [owlDateTime]="lud"
                />
                <owl-date-time #lud></owl-date-time>
              </label>
            </mat-form-field>
          </div>

          <!-- Extra registering deadline (for getting food etc.) -->
          <mat-label
            >Extra registreringsstop (t.ex sista dag för att få mat)</mat-label
          >
          <div style="display: flex; flex-direction: row">
            <mat-form-field>
              <label class="example-input-wrapper">
                <input
                  matInput
                  placeholder="Extra deadline"
                  [(ngModel)]="post.extraRegisterDeadline"
                  name="extraRegisterDeadline"
                  [min]="post.publishTime"
                  [owlDateTimeTrigger]="erd"
                  [owlDateTime]="erd"
                />
                <owl-date-time #erd></owl-date-time>
              </label>
            </mat-form-field>
          </div>
          <mat-form-field>
            <input
              matInput
              placeholder="Anledning för extra deadline"
              [(ngModel)]="post.extraRegisterReason"
              name="extraRegisterReason"
            />
          </mat-form-field>
        </ng-container>

        <!--fileupload-->
        <div fxLayout="row wrap" fxLayoutGap="16px grid">
          <mat-label>Ladda upp egna bilder här</mat-label>
          <!--Upload button-->
          <div fxFlex="50">
            <button
              mat-raised-button
              (click)="file.click()"
              type="button"
              color="blue"
            >
              Ladda upp
            </button>
            <input
              #file
              type="file"
              accept="image/*"
              style="display:none;"
              (change)="uploadImageFile($event)"
            />
          </div>

          <!--Upload feedback-->
          <div fxFlex="50" fxFlexAlign="center">
            <div fxLayout="row">
              <mat-icon
                *ngIf="!uploading && uploadPercentage == 100"
                color="primary"
              >
                check_circle_outline
              </mat-icon>
              <!-- <mat-icon *ngIf="!uploading">
              highlight_off
            </mat-icon>-->
              <mat-icon *ngIf="uploading">
                <mat-progress-spinner
                  [diameter]="22"
                  [mode]="'determinate'"
                  color="green"
                  [value]="uploadPercentage"
                >
                </mat-progress-spinner>
              </mat-icon>
              <span>{{ fileName }}</span>
              <img [src]="url" height="200" />
            </div>
          </div>
        </div>
      </form>

      <mat-list dense *ngIf="post.imgURLs.length !== 0">
        <mat-label>Länkar till bilder</mat-label>
        <mat-divider></mat-divider>
        <mat-list-item *ngFor="let url of post.imgURLs; index as i">
          Bild {{ i + 1 }}: {{ url }}
          <mat-divider></mat-divider>
        </mat-list-item>
      </mat-list>
    </mat-card-content>
  </div>
</mat-card>
